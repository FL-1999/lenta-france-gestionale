{% extends "shared/base.html" %}
{% set lang = request.cookies.get('lang', 'it') %}

{% block title %}
    {% if lang == 'fr' %}Personnel ‚Äì Manager{% else %}Personale ‚Äì Manager{% endif %}
{% endblock %}

{% block content %}
<div class="page-header">
    <div class="page-header-main">
        <h1 class="page-title">
            üë• {% if lang == 'fr' %}Personnel{% else %}Personale{% endif %}
        </h1>
        <p class="page-subtitle">
            {% if lang == 'fr' %}
                Gestion compl√®te du personnel de l'entreprise.
            {% else %}
                Gestione completa del personale aziendale.
            {% endif %}
        </p>
    </div>
    {% if has_perm(user, 'manager.access') %}
        <div class="header-actions">
            <a href="{{ url_for('manager_personale_new') }}" class="btn btn-primary">
                ‚ûï {% if lang == 'fr' %}Nouvel employ√©{% else %}Nuovo personale{% endif %}
            </a>
        </div>
    {% endif %}
</div>

<div class="page-actions-sticky">
    <a href="{{ url_for('manager_personale_list') }}" class="btn btn-secondary is-active">
        {% if lang == 'fr' %}Liste{% else %}Elenco{% endif %}
    </a>
    {% if has_perm(user, 'manager.access') %}
        <a href="{{ url_for('manager_personale_new') }}" class="btn btn-primary">
            ‚ûï {% if lang == 'fr' %}Nouveau{% else %}Nuovo{% endif %}
        </a>
        <a href="{{ url_for('manager_personale_presenze') }}" class="btn btn-secondary">
            üìÖ {% if lang == 'fr' %}Pr√©sences{% else %}Presenze{% endif %}
        </a>
    {% endif %}
</div>

<div class="card table-card">
    <div class="card-body">
        <table class="data-table">
            <thead>
                <tr>
                    <th>{% if lang == 'fr' %}Nom{% else %}Nome{% endif %}</th>
                    <th>{% if lang == 'fr' %}R√¥le{% else %}Ruolo{% endif %}</th>
                    <th>{% if lang == 'fr' %}T√©l√©phone{% else %}Telefono{% endif %}</th>
                    <th>Email</th>
                    <th>{% if lang == 'fr' %}Embauch√© le{% else %}Assunto il{% endif %}</th>
                    <th class="text-right">{% if lang == 'fr' %}Statut{% else %}Stato{% endif %}</th>
                    <th class="actions-col">{% if lang == 'fr' %}Actions{% else %}Azioni{% endif %}</th>
                </tr>
            </thead>
            <tbody>
                {% for p in personale %}
                    <tr>
                        <td>{{ p.cognome }} {{ p.nome }}</td>
                        <td>{{ p.ruolo or '‚Äî' }}</td>
                        <td>{{ p.telefono or '‚Äî' }}</td>
                        <td>{{ p.email or '‚Äî' }}</td>
                        <td>{{ p.data_assunzione or '‚Äî' }}</td>
                        <td class="text-right">
                            {% if p.attivo %}
                                <span class="badge badge-success">{% if lang == 'fr' %}Actif{% else %}Attivo{% endif %}</span>
                            {% else %}
                                <span class="badge badge-muted">{% if lang == 'fr' %}Inactif{% else %}Inattivo{% endif %}</span>
                            {% endif %}
                        </td>
                        <td class="actions-col">
                            {% if p.id %}
                                <div class="table-actions">
                                    {% if has_perm(user, 'manager.access') %}
                                        <a class="btn btn-secondary btn-sm"
                                           href="{{ url_for('manager_personale_edit', personale_id=p.id) }}">
                                            ‚úèÔ∏è {% if lang == 'fr' %}Modifier{% else %}Modifica{% endif %}
                                        </a>
                                    {% endif %}
                                    {% if has_perm(user, 'records.delete') %}
                                    <form method="post"
                                          action="{{ url_for('manager_personale_delete', personale_id=p.id) }}">
                                        <button type="submit"
                                                class="btn btn-danger btn-sm"
                                                onclick="return confirm('{% if lang == 'fr' %}Supprimer cet enregistrement ?{% else %}Eliminare questa scheda?{% endif %}');">
                                            üóëÔ∏è {% if lang == 'fr' %}Supprimer{% else %}Elimina{% endif %}
                                        </button>
                                    </form>
                                    {% endif %}
                                </div>
                            {% else %}
                                <div class="table-actions table-actions--empty">‚Äî</div>
                            {% endif %}
                        </td>
                    </tr>
                {% else %}
                    <tr class="table-empty">
                        <td colspan="7">
                            {% if lang == 'fr' %}
                                Aucun personnel enregistr√© pour le moment.
                            {% else %}
                                Nessun personale registrato al momento.
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% if total_pages and total_pages > 1 %}
  <div class="pagination-row" style="margin-top: 1.5rem;">
    <div class="pagination-meta">
      {% if lang == 'fr' %}Page {{ page }} sur {{ total_pages }}{% else %}Pagina {{ page }} di {{ total_pages }}{% endif %}
    </div>
    <div class="pagination-actions">
      {% if page > 1 %}
        <a class="btn btn-secondary btn-sm" href="{{ request.url.include_query_params(page=page-1, per_page=per_page) }}">&laquo; {% if lang == 'fr' %}Pr√©c√©dent{% else %}Precedente{% endif %}</a>
      {% endif %}
      {% if page < total_pages %}
        <a class="btn btn-secondary btn-sm" href="{{ request.url.include_query_params(page=page+1, per_page=per_page) }}">{% if lang == 'fr' %}Suivant{% else %}Successiva{% endif %} &raquo;</a>
      {% endif %}
    </div>
  </div>
{% endif %}
{% endblock %}
