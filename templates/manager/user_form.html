{% extends "base.html" %}

{% block title %}Nuovo utente â€“ Manager{% endblock %}

{% block content %}
<div class="page-header">
    <h1>{% if mode == "create" %}Nuovo utente{% else %}Modifica utente{% endif %}</h1>
</div>

<form method="post">
  {% if error_message %}
    <div class="alert alert-danger">{{ error_message }}</div>
  {% endif %}

  <div class="form-group">
    <label>Email*</label>
    <input type="email" name="email" required
           value="{{ form_email if form_email is defined else (user_obj.email if user_obj else '') }}">
  </div>

  <div class="form-group">
    <label>Nome completo</label>
    <input type="text" name="full_name"
           value="{{ form_full_name if form_full_name is defined else (user_obj.full_name if user_obj else '') }}">
  </div>

  <div class="form-group">
    <label>Password*</label>
    <input type="password" name="password" required>
  </div>

  <div class="form-group">
    <label>Ruolo*</label>
    <select name="role" required>
      {% for r in role_choices %}
        {% set value = r.value if hasattr(r, "value") else (r.name if hasattr(r, "name") else r) %}
        <option value="{{ value }}"{% if (form_role is defined and form_role == value) or (form_role is not defined and user_obj and (user_obj.role == r or user_obj.role == value)) %} selected{% endif %}>
          {{ value }}
        </option>
      {% endfor %}
    </select>
  </div>

  <div class="form-group">
    <label>Lingua</label>
    <select name="language">
      <option value="">(Nessuna)</option>
      {% for lang in language_choices %}
        <option value="{{ lang }}"
          {% if (form_language is defined and form_language == lang) or (form_language is not defined and user_obj and user_obj.language == lang) %}
            selected
          {% endif %}
        >
          {{ lang }}
        </option>
      {% endfor %}
    </select>
  </div>

  <div class="form-actions">
    <button type="submit">Salva</button>
    <a href="/manager/utenti">Annulla</a>
  </div>
</form>
{% endblock %}
