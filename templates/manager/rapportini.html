{% extends "base.html" %}

{% block title %}Rapportini â€“ Manager{% endblock %}

{% block content %}
<div class="page-header">
  <h1>ðŸ“„ Rapportini giornalieri</h1>
  <p class="subtitle">Consulta tutti i rapportini e filtra per data o cantiere.</p>
</div>

<form method="get" class="filters">
  <label>
    Da data:
    <input type="date" name="from_date" value="{{ filter_from_date or '' }}">
  </label>
  <label>
    A data:
    <input type="date" name="to_date" value="{{ filter_to_date or '' }}">
  </label>
  <label>
    Cantiere:
    <input type="text" name="site" value="{{ filter_site or '' }}" placeholder="Nome o codice cantiere">
  </label>
  <button type="submit">Filtra</button>
  <a href="/manager/rapportini">Reset</a>
</form>

<div class="table-wrapper">
  <table class="table">
    <thead>
      <tr>
        <th>Data</th>
        <th>Cantiere</th>
        <th>Ore totali</th>
        <th>N. operai</th>
        <th>Creato da</th>
        <th>Note</th>
        <th>Dettaglio</th>
      </tr>
    </thead>
    <tbody>
      {% for r in reports %}
      <tr>
        <td>{{ r.date.strftime("%d/%m/%Y") }}</td>
        <td>{{ r.site_name_or_code }}</td>
        <td>{{ "%.1f"|format(r.total_hours) }}</td>
        <td>{{ r.workers_count }}</td>
        <td>
          {% if r.created_by %}
            {{ r.created_by.full_name or r.created_by.email }}
          {% else %}
            -
          {% endif %}
        </td>
        <td>{{ r.notes or r.activities or "-" }}</td>
        <td>
          <a href="/manager/rapportini/{{ r.id }}">Apri</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% if not reports or reports|length == 0 %}
  <p>Nessun rapportino trovato con questi filtri.</p>
{% endif %}
{% endblock %}
