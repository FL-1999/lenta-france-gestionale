{% extends "shared/base.html" %}
{% set lang = request.cookies.get('lang', 'it') %}

{% block title %}
    {% if lang == 'fr' %}Articles sous seuil{% else %}Articoli sotto soglia{% endif %}
{% endblock %}

{% block content %}
<div class="page-header">
    <div class="page-header-main">
        <h1 class="page-title">üìâ {% if lang == 'fr' %}Articles sous seuil{% else %}Articoli sotto soglia{% endif %}</h1>
        <p class="page-subtitle">
            {% if lang == 'fr' %}
                Liste des articles √† r√©approvisionner et quantit√©s sugg√©r√©es.
            {% else %}
                Elenco degli articoli da reintegrare e quantit√† suggerite.
            {% endif %}
        </p>
    </div>
    <div class="header-actions">
        <form method="post" action="{{ url_for('manager_magazzino_sotto_soglia_crea_richiesta') }}" style="display: inline;">
            <button type="submit" class="btn btn-primary" {% if not suggested_entries %}disabled{% endif %}>
                üßæ {% if lang == 'fr' %}Cr√©er une demande{% else %}Crea richiesta{% endif %}
            </button>
        </form>
        <a href="{{ url_for('manager_magazzino_list') }}" class="btn btn-secondary">
            ‚Üê {% if lang == 'fr' %}Retour au magasin{% else %}Torna al magazzino{% endif %}
        </a>
    </div>
</div>

<div class="list-search-sticky">
    <div class="list-search-inner">
        <label class="form-label" for="list-search">
            {% if lang == 'fr' %}Rechercher un article{% else %}Cerca articolo{% endif %}
        </label>
        <input
            type="search"
            id="list-search"
            class="form-control"
            placeholder="{% if lang == 'fr' %}Code, nom...{% else %}Codice, nome...{% endif %}">
    </div>
</div>

<div class="card">
    <div class="card-header">
        <div class="card-title">
            {% if lang == 'fr' %}Articles sous seuil{% else %}Articoli sotto soglia{% endif %}
            <span class="muted" style="margin-left: 0.5rem;">({{ items_count }})</span>
        </div>
    </div>
    <div class="card-body list-table">
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>{% if lang == 'fr' %}Code{% else %}Codice{% endif %}</th>
                        <th>{% if lang == 'fr' %}Nom{% else %}Nome{% endif %}</th>
                        <th>{% if lang == 'fr' %}Disponible{% else %}Disponibile{% endif %}</th>
                        <th>{% if lang == 'fr' %}Seuil{% else %}Soglia{% endif %}</th>
                        <th>{% if lang == 'fr' %}√Ä commander{% else %}Da ordinare{% endif %}</th>
                    </tr>
                </thead>
                <tbody>
                    {% if items %}
                        {% for entry in items %}
                            {% set item = entry.item %}
                            <tr data-list-item>
                                <td>{{ item.codice or '‚Äî' }}</td>
                                <td>{{ item.nome }}</td>
                                <td>{{ item.quantita_disponibile }}</td>
                                <td>{{ item.soglia_minima }}</td>
                                <td>
                                    {% if entry.da_ordinare is not none %}
                                        {{ entry.da_ordinare }}
                                    {% else %}
                                        ‚Äî
                                    {% endif %}
                                </td>
                            </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="5" class="muted">
                                {% if lang == 'fr' %}
                                    Aucun article sous seuil.
                                {% else %}
                                    Nessun articolo sotto soglia.
                                {% endif %}
                            </td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="list-cards">
    {% if items %}
        {% for entry in items %}
            {% set item = entry.item %}
            <article class="card list-card" data-list-item>
                <div class="card-body">
                    <div class="list-card-header">
                        <h3>{{ item.nome }}</h3>
                        <span class="badge badge-warning">
                            {% if lang == 'fr' %}Sous seuil{% else %}Sotto soglia{% endif %}
                        </span>
                    </div>
                    <div class="list-card-meta">
                        <div>
                            <span class="label">{% if lang == 'fr' %}Code{% else %}Codice{% endif %}</span>
                            <span class="value">{{ item.codice or '‚Äî' }}</span>
                        </div>
                        <div>
                            <span class="label">{% if lang == 'fr' %}Disponible{% else %}Disponibile{% endif %}</span>
                            <span class="value">{{ item.quantita_disponibile }}</span>
                        </div>
                        <div>
                            <span class="label">{% if lang == 'fr' %}Seuil{% else %}Soglia{% endif %}</span>
                            <span class="value">{{ item.soglia_minima }}</span>
                        </div>
                        <div>
                            <span class="label">{% if lang == 'fr' %}√Ä commander{% else %}Da ordinare{% endif %}</span>
                            <span class="value">
                                {% if entry.da_ordinare is not none %}
                                    {{ entry.da_ordinare }}
                                {% else %}
                                    ‚Äî
                                {% endif %}
                            </span>
                        </div>
                    </div>
                </div>
            </article>
        {% endfor %}
    {% else %}
        <div class="card list-card">
            <div class="card-body table-empty">
                {% if lang == 'fr' %}
                    Aucun article sous seuil.
                {% else %}
                    Nessun articolo sotto soglia.
                {% endif %}
            </div>
        </div>
    {% endif %}
</div>

<script src="{{ url_for('static', path='/js/list-search.js') }}"></script>
{% endblock %}
