{% extends "shared/base.html" %}
{% set lang = request.cookies.get('lang', 'it') %}

{% block title %}
    {% if lang == 'fr' %}Magasin ‚Äì Manager{% else %}Magazzino ‚Äì Manager{% endif %}
{% endblock %}

{% block content %}
<div class="page-header">
    <div class="page-header-main">
        <h1 class="page-title">üì¶ {% if lang == 'fr' %}Magasin{% else %}Magazzino{% endif %}</h1>
        <p class="page-subtitle">
            {% if lang == 'fr' %}
                G√©rez les articles du magasin et les niveaux de stock.
            {% else %}
                Gestisci gli articoli di magazzino e le quantit√† disponibili.
            {% endif %}
        </p>
    </div>
    <div class="header-actions">
        <a href="{{ url_for('manager_magazzino_richieste') }}" class="btn btn-secondary">
            üßæ {% if lang == 'fr' %}Demandes{% else %}Richieste{% endif %}
        </a>
        <a href="{{ url_for('manager_magazzino_new') }}" class="btn btn-primary">
            ‚ûï {% if lang == 'fr' %}Nouvel article{% else %}Nuovo articolo{% endif %}
        </a>
    </div>
</div>

{% set state = namespace(has_items=false) %}
{% for categoria in categorie %}
    {% set category_items = items_by_categoria.get(categoria.key, []) %}
    {% if category_items %}
        {% set state.has_items = true %}
        <section class="magazzino-category">
            <div class="magazzino-category-header">
                <h2>
                    {% if lang == 'fr' %}{{ categoria.label_fr }}{% else %}{{ categoria.label_it }}{% endif %}
                </h2>
            </div>
            <div class="magazzino-items-grid">
                {% for item in category_items %}
                    <div class="card magazzino-item-card">
                        <div class="card-body">
                            <div class="magazzino-item-header">
                                <h3>{{ item.nome }}</h3>
                                {% if item.attivo %}
                                    <span class="badge badge-success">{% if lang == 'fr' %}Actif{% else %}Attivo{% endif %}</span>
                                {% else %}
                                    <span class="badge badge-muted">{% if lang == 'fr' %}Inactif{% else %}Inattivo{% endif %}</span>
                                {% endif %}
                            </div>
                            <p class="magazzino-item-meta">
                                <span>{% if lang == 'fr' %}Unit√©{% else %}Unit√†{% endif %}: {{ item.unita_misura }}</span>
                            </p>
                            <p class="magazzino-item-desc">{{ item.descrizione or '‚Äî' }}</p>
                            <div class="magazzino-item-stats">
                                <div>
                                    <span class="label">{% if lang == 'fr' %}Quantit√©{% else %}Quantit√†{% endif %}</span>
                                    <span class="value">{{ item.quantita_disponibile }}</span>
                                </div>
                                <div>
                                    <span class="label">{% if lang == 'fr' %}Seuil{% else %}Soglia{% endif %}</span>
                                    <span class="value">{{ item.soglia_minima or '‚Äî' }}</span>
                                </div>
                            </div>
                            <div class="card-actions">
                                <a href="{{ url_for('manager_magazzino_edit', item_id=item.id) }}" class="btn btn-secondary btn-sm">
                                    ‚úèÔ∏è {% if lang == 'fr' %}Modifier{% else %}Modifica{% endif %}
                                </a>
                                <form method="post" action="{{ url_for('manager_magazzino_delete', item_id=item.id) }}">
                                    <button type="submit" class="btn btn-danger btn-sm"
                                            onclick="return confirm('{% if lang == 'fr' %}D√©sactiver cet article ?{% else %}Disattivare questo articolo?{% endif %}');">
                                        üóëÔ∏è {% if lang == 'fr' %}D√©sactiver{% else %}Disattiva{% endif %}
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </section>
    {% endif %}
{% endfor %}

{% if not state.has_items %}
    <div class="card table-card">
        <div class="card-body">
            <div class="table-empty">
                {% if lang == 'fr' %}
                    Aucun article disponible.
                {% else %}
                    Nessun articolo disponibile.
                {% endif %}
            </div>
        </div>
    </div>
{% endif %}
{% endblock %}
