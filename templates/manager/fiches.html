{% extends "base.html" %}

{% block title %}Fiches – Manager{% endblock %}

{% block content %}
<div class="page-header">
  <h1 class="page-title">
    <span class="page-icon page-icon--fiches" aria-hidden="true">
      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M7.5 4h7L17.5 7.5V20h-10V4z" stroke="currentColor" stroke-linejoin="round"/>
        <path d="M14.5 4v4h4" stroke="currentColor" stroke-linejoin="round"/>
        <path d="M9.5 11h5" stroke="currentColor" stroke-linecap="round"/>
        <path d="M9.5 14h5" stroke="currentColor" stroke-linecap="round"/>
      </svg>
    </span>
    Fiches – Manager
  </h1>
</div>

<form method="get" class="filters">
  <label>Da data:
    <input type="date" name="from_date" value="{{ filter_from_date or '' }}">
  </label>
  <label>A data:
    <input type="date" name="to_date" value="{{ filter_to_date or '' }}">
  </label>
  <label>Cantiere:
    <select name="site_id">
      <option value="">Tutti</option>
      {% for s in sites %}
        <option value="{{ s.id }}" {% if filter_site_id and filter_site_id == s.id %}selected{% endif %}>
          {{ s.name }} ({{ s.code }})
        </option>
      {% endfor %}
    </select>
  </label>
  <label>Tipo fiche:
    <select name="fiche_type">
      <option value="">Tutti</option>
      {% for ft in fiche_types %}
        <option value="{{ ft.value }}" {% if filter_fiche_type == ft.value %}selected{% endif %}>{{ ft.value }}</option>
      {% endfor %}
    </select>
  </label>
  <button type="submit" class="btn btn-primary">Filtra</button>
  <a href="/manager/fiches" class="btn btn-secondary">Reset</a>
</form>

{% if fiches %}
<table class="table">
  <thead>
    <tr>
      <th>Data</th>
      <th>Cantiere</th>
      <th>Macchina</th>
      <th>Tipo</th>
      <th>Ore</th>
      <th>Creato da</th>
      <th>Dettaglio</th>
    </tr>
  </thead>
  <tbody>
    {% for f in fiches %}
    <tr>
      <td>{{ f.date.strftime("%d/%m/%Y") }}</td>
      <td>{{ f.site.name if f.site else "" }}</td>
      <td>{% if f.machine %}{{ f.machine.name }}{% else %}-{% endif %}</td>
      <td>{{ f.fiche_type.value }}</td>
      <td>{{ "%.1f"|format(f.hours) }}</td>
      <td>{{ f.created_by.full_name or f.created_by.email }}</td>
      <td>
        <a href="/manager/fiches/{{ f.id }}" class="btn btn-sm btn-secondary">Apri</a>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<p>Nessuna fiche trovata.</p>
{% endif %}
{% endblock %}
