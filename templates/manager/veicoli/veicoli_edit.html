{% extends "base.html" %}
{% set lang = request.cookies.get('lang', 'it') %}
{% block title %}
    {% if lang == 'fr' %}Modifier le v√©hicule{% else %}Modifica veicolo{% endif %}
{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">
        üöê {% if lang == 'fr' %}Modifier le v√©hicule{% else %}Modifica veicolo{% endif %}
    </h1>
    <p class="page-subtitle">
        {% if lang == 'fr' %}
            Mettez √† jour les informations du v√©hicule s√©lectionn√©.
        {% else %}
            Aggiorna le informazioni del veicolo selezionato.
        {% endif %}
    </p>
</div>

<form method="post" class="form-card">

    <!-- DATI PRINCIPALI -->
    <h2 class="section-title">
        {% if lang == 'fr' %}Donn√©es principales{% else %}Dati principali{% endif %}
    </h2>

    <div class="form-grid-2">
        <div class="form-field">
            <label>Marca*</label>
            <input type="text" name="marca" value="{{ veicolo.marca }}" required>
        </div>

        <div class="form-field">
            <label>Modello*</label>
            <input type="text" name="modello" value="{{ veicolo.modello }}" required>
        </div>

        <div class="form-field">
            <label>Targa*</label>
            <input type="text" name="targa" value="{{ veicolo.targa }}" required>
            <small>
                {% if lang == 'fr' %}
                    Enregistr√©e automatiquement en majuscule.
                {% else %}
                    La targa verr√† salvata automaticamente in maiuscolo.
                {% endif %}
            </small>
        </div>

        <div class="form-field">
            <label>{% if lang == 'fr' %}Ann√©e{% else %}Anno{% endif %}</label>
            <input type="number" name="anno"
                   value="{{ veicolo.anno or '' }}"
                   min="1900" max="2100">
        </div>
    </div>

    <!-- DETTAGLI VEICOLO -->
    <h2 class="section-title">
        {% if lang == 'fr' %}D√©tails du v√©hicule{% else %}Dettagli veicolo{% endif %}
    </h2>

    <div class="form-grid-2">
        <div class="form-field">
            <label>Km</label>
            <input type="number" name="km" value="{{ veicolo.km or '' }}">
            <small>
                {% if lang == 'fr' %}
                    Kilom√©trage actuel (m√™me approximatif).
                {% else %}
                    Chilometraggio attuale (anche indicativo).
                {% endif %}
            </small>
        </div>

        <div class="form-field">
            <label>{% if lang == 'fr' %}Carburant{% else %}Carburante{% endif %}</label>
            <select name="carburante">
                <option value="">
                    {% if lang == 'fr' %}S√©lectionner{% else %}Seleziona{% endif %}
                </option>
                <option value="Diesel"   {% if veicolo.carburante == "Diesel" %}selected{% endif %}>Diesel</option>
                <option value="Benzina"  {% if veicolo.carburante == "Benzina" %}selected{% endif %}>Benzina</option>
                <option value="GPL"      {% if veicolo.carburante == "GPL" %}selected{% endif %}>GPL</option>
                <option value="Ibrido"   {% if veicolo.carburante == "Ibrido" %}selected{% endif %}>Ibrido</option>
                <option value="Elettrico"{% if veicolo.carburante == "Elettrico" %}selected{% endif %}>Elettrico</option>
            </select>
        </div>
    </div>

    <!-- SCADENZE -->
    <h2 class="section-title">
        {% if lang == 'fr' %}√âch√©ances{% else %}Scadenze{% endif %}
    </h2>

    <div class="form-grid-2">
        <div class="form-field">
            <label>
                {% if lang == 'fr' %}R√©vision ‚Äì √©ch√©ance{% else %}Revisione ‚Äì scadenza{% endif %}
            </label>
            <input type="date" name="revisione_scadenza"
                   value="{{ veicolo.revisione_scadenza.isoformat() if veicolo.revisione_scadenza else '' }}">
        </div>

        <div class="form-field">
            <label>
                {% if lang == 'fr' %}Assurance ‚Äì √©ch√©ance{% else %}Assicurazione ‚Äì scadenza{% endif %}
            </label>
            <input type="date" name="assicurazione_scadenza"
                   value="{{ veicolo.assicurazione_scadenza.isoformat() if veicolo.assicurazione_scadenza else '' }}">
        </div>
    </div>

    <!-- ASSEGNAZIONE -->
    <h2 class="section-title">
        {% if lang == 'fr' %}Affectation{% else %}Assegnazione{% endif %}
    </h2>

    <div class="form-grid-2">
        <div class="form-field">
            <label>
                {% if lang == 'fr' %}V√©hicule assign√© √†{% else %}Veicolo assegnato a{% endif %}
            </label>
            <select name="assegnato_a_id">
                <option value="">
                    {% if lang == 'fr' %}Aucun / v√©hicule partag√©{% else %}Nessuno / veicolo condiviso{% endif %}
                </option>
                {% for persona in personale_list %}
                    <option value="{{ persona.id }}"
                        {% if veicolo.assegnato_a_id == persona.id %}selected{% endif %}>
                        {{ persona.nome }} {{ persona.cognome }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div class="form-field">
            <label>Note</label>
            <textarea name="note"
                      placeholder="{% if lang == 'fr' %}Informations suppl√©mentaires{% else %}Assicurazione, stato generale, conducente abituale...{% endif %}">{{ veicolo.note or '' }}</textarea>
        </div>
    </div>

    <div class="form-actions">
        <a href="{{ url_for('manager_veicoli_list') }}" class="btn btn-secondary">
            {% if lang == 'fr' %}Annuler{% else %}Annulla{% endif %}
        </a>
        <button type="submit" class="btn btn-primary">
            {% if lang == 'fr' %}Enregistrer{% else %}Salva{% endif %}
        </button>
    </div>
</form>
{% endblock %}
