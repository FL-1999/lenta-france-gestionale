{% extends "shared/base.html" %}
{% set lang = request.cookies.get('lang', 'it') %}

{% block title %}
  {% if lang == 'fr' %}Nouveau v√©hicule{% else %}Nuovo veicolo{% endif %}
{% endblock %}

{% block content %}
<div class="page-header">
  <div class="page-header-main">
    <p class="page-eyebrow">
      {% if lang == 'fr' %}Gestion des v√©hicules{% else %}Gestione veicoli{% endif %}
    </p>
    <h1 class="page-title">üöê {% if lang == 'fr' %}Nouveau v√©hicule{% else %}Nuovo veicolo{% endif %}</h1>
    <p class="page-subtitle">
      {% if lang == 'fr' %}
        Ajoutez un nouveau v√©hicule au parc automobile de l‚Äôentreprise.
      {% else %}
        Aggiungi un nuovo veicolo aziendale alla flotta, con i dati principali e le scadenze.
      {% endif %}
    </p>
  </div>

  <div class="header-actions">
    <a href="{{ url_for('manager_veicoli_list') }}" class="btn btn-secondary">
      ‚Üê {% if lang == 'fr' %}Retour{% else %}Indietro{% endif %}
    </a>
  </div>
</div>

<div class="page-actions-sticky">
  <a href="{{ url_for('manager_veicoli_list') }}" class="btn btn-secondary">
    {% if lang == 'fr' %}Liste{% else %}Elenco{% endif %}
  </a>
  <a href="{{ url_for('manager_veicoli_new') }}" class="btn btn-primary is-active">
    ‚ûï {% if lang == 'fr' %}Nouveau{% else %}Nuovo{% endif %}
  </a>
</div>

<form method="post" class="form-sticky-space" id="veicoli-form">
  <nav class="form-step-nav" aria-label="{% if lang == 'fr' %}Sections du formulaire{% else %}Sezioni del modulo{% endif %}">
    <a href="#veicoli-base">{% if lang == 'fr' %}Donn√©es principales{% else %}Dati base{% endif %}</a>
    <a href="#veicoli-details">{% if lang == 'fr' %}D√©tails{% else %}Dettagli{% endif %}</a>
    <a href="#veicoli-deadlines">{% if lang == 'fr' %}√âch√©ances{% else %}Scadenze{% endif %}</a>
    <a href="#veicoli-assignment">{% if lang == 'fr' %}Affectation{% else %}Assegnazione{% endif %}</a>
  </nav>
  <div class="card large-form-card vehicle-form-card">
    <div class="card-header">
      <div class="card-title">
        <span>{% if lang == 'fr' %}D√©tails du v√©hicule{% else %}Dettagli veicolo{% endif %}</span>
      </div>
      <p class="card-subtitle">
        {% if lang == 'fr' %}
          Compl√©tez les informations principales, les √©ch√©ances et l‚Äôaffectation.
        {% else %}
          Compila i dati principali, le scadenze e l‚Äôeventuale assegnazione del veicolo.
        {% endif %}
      </p>
    </div>

    <div class="card-body">
      <!-- DATI PRINCIPALI -->
      <section id="veicoli-base" class="form-section">
        <h2 class="section-title">{% if lang == 'fr' %}Donn√©es principales{% else %}Dati principali{% endif %}</h2>
        <div class="form-grid-2">
          <div class="form-field">
            <label>Marca*</label>
            <input type="text" name="marca" placeholder="Es. Fiat" required>
          </div>

          <div class="form-field">
            <label>Modello*</label>
            <input type="text" name="modello" placeholder="Es. Ducato" required>
          </div>

          <div class="form-field">
            <label>Targa*</label>
            <input type="text" name="targa" placeholder="AB123CD" required>
            <small>
              {% if lang == 'fr' %}
                La plaque sera enregistr√©e automatiquement en majuscule.
              {% else %}
                La targa verr√† salvata automaticamente in maiuscolo.
              {% endif %}
            </small>
          </div>

          <div class="form-field">
            <label>{% if lang == 'fr' %}Ann√©e{% else %}Anno{% endif %}</label>
            <input type="number" name="anno" placeholder="2020" min="1900" max="2100">
          </div>
        </div>
      </section>

      <!-- DETTAGLI VEICOLO -->
      <section id="veicoli-details" class="form-section">
        <h2 class="section-title">{% if lang == 'fr' %}D√©tails du v√©hicule{% else %}Dettagli veicolo{% endif %}</h2>
        <div class="form-grid-2">
          <div class="form-field">
            <label>Km</label>
            <input type="number" name="km" placeholder="150000">
            <small>
              {% if lang == 'fr' %}
                Kilom√©trage actuel (m√™me approximatif).
              {% else %}
                Chilometraggio attuale (anche indicativo).
              {% endif %}
            </small>
          </div>

          <div class="form-field">
            <label>{% if lang == 'fr' %}Carburant{% else %}Carburante{% endif %}</label>
            <select name="carburante">
              <option value="">{% if lang == 'fr' %}S√©lectionner{% else %}Seleziona{% endif %}</option>
              <option value="Diesel">Diesel</option>
              <option value="Benzina">Benzina</option>
              <option value="GPL">GPL</option>
              <option value="Ibrido">Ibrido</option>
              <option value="Elettrico">Elettrico</option>
            </select>
          </div>
        </div>
      </section>

      <!-- SCADENZE -->
      <section id="veicoli-deadlines" class="form-section">
        <h2 class="section-title">{% if lang == 'fr' %}√âch√©ances{% else %}Scadenze{% endif %}</h2>
        <div class="form-grid-2">
          <div class="form-field">
            <label>{% if lang == 'fr' %}R√©vision ‚Äì √©ch√©ance{% else %}Revisione ‚Äì scadenza{% endif %}</label>
            <input type="date" name="revisione_scadenza">
          </div>
          <div class="form-field">
            <label>{% if lang == 'fr' %}Assurance ‚Äì √©ch√©ance{% else %}Assicurazione ‚Äì scadenza{% endif %}</label>
            <input type="date" name="assicurazione_scadenza">
          </div>
        </div>
      </section>

      <!-- ASSEGNAZIONE -->
      <section id="veicoli-assignment" class="form-section">
        <h2 class="section-title">{% if lang == 'fr' %}Affectation{% else %}Assegnazione{% endif %}</h2>
        {% set people = personale_list|default([]) %}
        <div class="form-grid-2">
          <div class="form-field">
            <label>{% if lang == 'fr' %}V√©hicule assign√© √†{% else %}Veicolo assegnato a{% endif %}</label>
            <select name="assegnato_a_id">
              <option value="">
                {% if lang == 'fr' %}Aucun / v√©hicule partag√©{% else %}Nessuno / veicolo condiviso{% endif %}
              </option>
              {% for persona in people %}
                <option value="{{ persona.id }}">{{ persona.nome }} {{ persona.cognome }}</option>
              {% endfor %}
            </select>
            {% if not people %}
              <small style="opacity:.75;">
                {% if lang == 'fr' %}
                  Liste du personnel non disponible (variable <code>personale_list</code> manquante).
                {% else %}
                  Lista personale non disponibile (variabile <code>personale_list</code> mancante).
                {% endif %}
              </small>
            {% endif %}
          </div>

          <div class="form-field">
            <label>Note</label>
            <textarea name="note"
              placeholder="{% if lang == 'fr' %}Informations suppl√©mentaires{% else %}Assicurazione, stato generale, conducente abituale...{% endif %}"></textarea>
          </div>
        </div>
      </section>

      <!-- AZIONI -->
      <div class="form-actions">
        <a href="{{ url_for('manager_veicoli_list') }}" class="btn btn-secondary">
          {% if lang == 'fr' %}Annuler{% else %}Annulla{% endif %}
        </a>
        <button type="submit" class="btn btn-primary">
          {% if lang == 'fr' %}Enregistrer{% else %}Salva{% endif %}
        </button>
      </div>
    </div>
  </div>
</form>
<div class="form-actions-sticky">
  <a href="{{ url_for('manager_veicoli_list') }}" class="btn btn-secondary">
    {% if lang == 'fr' %}Annuler{% else %}Annulla{% endif %}
  </a>
  <button type="submit" form="veicoli-form" class="btn btn-primary">
    {% if lang == 'fr' %}Enregistrer{% else %}Salva{% endif %}
  </button>
</div>
{% endblock %}
