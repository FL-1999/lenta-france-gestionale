{% extends "shared/base.html" %}
{% set lang = request.cookies.get('lang', 'it') %}

{% block title %}
    {% if lang == 'fr' %}Mes demandes ‚Äì Magasin{% else %}Le mie richieste ‚Äì Magazzino{% endif %}
{% endblock %}

{% block content %}
<div class="page-header">
    <div class="page-header-main">
        <h1 class="page-title">üßæ {% if lang == 'fr' %}Mes demandes{% else %}Le mie richieste{% endif %}</h1>
        <p class="page-subtitle">
            {% if lang == 'fr' %}
                Suivez l'√©tat des demandes envoy√©es au magasin.
            {% else %}
                Segui lo stato delle richieste inviate al magazzino.
            {% endif %}
        </p>
    </div>
    <div class="header-actions">
        <a href="{{ url_for('capo_magazzino_list') }}" class="btn btn-secondary">
            ‚Üê {% if lang == 'fr' %}Retour au magasin{% else %}Torna al magazzino{% endif %}
        </a>
        <a href="{{ url_for('capo_magazzino_richiesta_new') }}" class="btn btn-primary">
            ‚ûï {% if lang == 'fr' %}Nouvelle demande{% else %}Nuova richiesta{% endif %}
        </a>
    </div>
</div>

<div class="card table-card">
    <div class="card-body">
        <table class="data-table">
            <thead>
                <tr>
                    <th>{% if lang == 'fr' %}ID{% else %}ID{% endif %}</th>
                    <th>{% if lang == 'fr' %}Date{% else %}Data{% endif %}</th>
                    <th>{% if lang == 'fr' %}Statut{% else %}Stato{% endif %}</th>
                    <th>{% if lang == 'fr' %}R√©ponse{% else %}Risposta{% endif %}</th>
                    <th>{% if lang == 'fr' %}Articles{% else %}Articoli{% endif %}</th>
                </tr>
            </thead>
            <tbody>
                {% for richiesta in richieste %}
                    <tr>
                        <td>#{{ richiesta.id }}</td>
                        <td>{{ richiesta.created_at.strftime('%d/%m/%Y') if richiesta.created_at else '‚Äî' }}</td>
                        <td>
                            <span class="badge">
                                {{ richiesta.stato.value if richiesta.stato else '‚Äî' }}
                            </span>
                        </td>
                        <td>{{ richiesta.risposta_manager or '‚Äî' }}</td>
                        <td>
                            {% if richiesta.righe %}
                                <ul>
                                    {% for riga in richiesta.righe %}
                                        <li>{{ riga.item.nome }} ‚Äì {{ riga.quantita_richiesta }} {{ riga.item.unita_misura }}</li>
                                    {% endfor %}
                                </ul>
                            {% else %}
                                ‚Äî
                            {% endif %}
                        </td>
                    </tr>
                {% else %}
                    <tr class="table-empty">
                        <td colspan="5">
                            {% if lang == 'fr' %}
                                Aucune demande enregistr√©e.
                            {% else %}
                                Nessuna richiesta registrata.
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
